import{g as y,i as v,c as R,u as A,o as h,s as q}from"./errores.87700437.js";import{a as p}from"./client.595546ea.js";import{N as S}from"./config.a3d1421f.js";import{A as g}from"./_astro-entry_sonner.dae5ec25.js";import"./hoisted.5157f620.js";import"./index.9e3bb68e.js";import"./index.ec3c183f.js";const w=y(p);w.setPersistence(v);const d=document.querySelector("#formRegister"),a=document.querySelector("#btnRegister");d.addEventListener("submit",async function(o){o.preventDefault();const r=new FormData(d),e=r.get("nombreRegister").toString(),s=r.get("apellido").toString(),t=r.get("correoRegister").toString(),n=r.get("contraseñaRegister").toString(),i=r.get("confirmarContra").toString();if(!e.trim()||e.length<4){document.querySelector("#errorNombreRegister").classList.remove("hidden");return}if(!s.trim()||s.length<4){document.querySelector("#errorApellidoRegister").classList.remove("hidden");return}if(!/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(t)){document.querySelector("#errorCorreoRegister").classList.remove("hidden");return}if(n.length<5){document.querySelector("#errorContraRegister").classList.remove("hidden");return}if(n!==i){document.querySelector("#errorConfirmRegister").classList.remove("hidden");return}a.textContent="Cargando...",a.classList.add("opacity-50"),a.setAttribute("disabled","true"),C(e,s,t,n),d.reset()});async function C(o,r,e,s){try{const t=await R(w,e,s),n={...t.user,nombre:o,apellido:r,displayName:`${o} ${r}`};await A(t.user,{displayName:`${o} ${r}`});const i=await t.user.getIdToken(),f=await fetch("/api/auth/registrarUsuario",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:JSON.stringify({user:n})}),{resDb:L}=await f.json();if(f.status===200){const b={uid:t.user.uid,displayName:t.user.displayName,email:t.user.email,photoUrl:t.user.photoURL,_id:L._id};localStorage.setItem(`${S}-userData`,JSON.stringify(b)),g.success("Inicio de sesión"),window.location.assign("/feed")}}catch(t){console.log(t),t.code&&(alert(JSON.stringify(t)),g.error(h(t.code)))}a.textContent="Registrarse",a.removeAttribute("disabled"),a.classList.remove("opacity-50")}d.querySelectorAll("input").forEach(o=>{o.addEventListener("input",r=>{document.querySelectorAll(".errorInput").forEach(e=>e.classList.add("hidden"))})});const E=document.getElementById("texto-maquina"),N=["Recicanje","Reciclar","Reutilizar","Reconectar","Remover","Retirar"];function m(o){return new Promise(r=>setTimeout(r,o))}async function D(o,r){let e=0,s=r[e],t=s.length,n=r.length,i=!0;for(;;)i?t--:t++,o.innerText=s.slice(0,t),t===1&&i?(e===n-1?o.classList.add("text-shadow"):o.classList.remove("text-shadow"),await m(300),e=e===n-1?0:e+1,s=r[e],i=!1):t===s.length&&!i&&(t=s.length,i=!0,await m(o.classList.contains("text-shadow")?3e3:500)),await m(80)}D(E,N);const I=y(p),$=document.querySelector("#btnAbrirModal"),u=document.querySelector("#modalFormulario"),P=document.querySelector("#cerrarModal");$.addEventListener("click",o=>{u.classList.remove("opacity-0"),u.classList.remove("pointer-events-none"),document.body.style.overflow="hidden"});P.addEventListener("click",()=>{u.classList.add("opacity-0"),u.classList.add("pointer-events-none"),document.body.style.overflow="unset"});const l=document.querySelector("#formularioIniciarSesion"),c=document.querySelector("#btnIniciar");l.addEventListener("submit",async o=>{o.preventDefault();const r=new FormData(l),e=r.get("contraseña").toString(),s=r.get("correo").toString();if(!/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(s)){document.querySelector("#errorCorreo").classList.remove("hidden");return}if(e.length<5){document.querySelector("#errorContra").classList.remove("hidden");return}c.textContent="cargando...",c.classList.add("opacity-50"),c.setAttribute("disabled","true"),x(s,e),l.reset()});async function x(o,r){try{const e=await q(I,o,r),s=await e.user.getIdToken(),t=await fetch("/api/auth/iniciarSesion",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:JSON.stringify({uid:e.user.uid})}),{resDb:n}=await t.json();if(t.status===200){const i={uid:e.user.uid,displayName:e.user.displayName,email:e.user.email,photoUrl:e.user.photoURL,_id:n._id};localStorage.setItem(`${S}-userData`,JSON.stringify(i)),window.location.assign("/feed")}}catch(e){alert(JSON.stringify(e));const s=h(e.code);g.error(s)}c.textContent="ingresar",c.classList.remove("opacity-50"),c.removeAttribute("disabled")}l.querySelectorAll("input").forEach(o=>{o.addEventListener("input",r=>{document.querySelectorAll(".errorInput").forEach(e=>e.classList.add("hidden"))})});
